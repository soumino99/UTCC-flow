<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UTCC æ´»å‹•è¨ºæ–­ â€” UTCCã«å…¥ã£ãŸã‚‰ä½•ã‚’ã—ã‚ˆã†ï¼Ÿ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --brown-dark:  #3E2723;
      --brown-mid:   #6D4C41;
      --brown-light: #A1887F;
      --cream:       #FFF8F0;
      --cream-dark:  #F0E6D3;
      --gold:        #C8960C;
      --white:       #FFFFFF;
      --shadow:      0 4px 24px rgba(62, 39, 35, 0.12);
      --shadow-hover: 0 8px 32px rgba(62, 39, 35, 0.22);
      --radius:      18px;
      --transition:  0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--cream);
      color: var(--brown-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px 16px 48px;
    }

    /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      text-align: center;
      margin-bottom: 12px;
    }
    .logo {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.15em;
      color: var(--brown-light);
      text-transform: uppercase;
    }

    /* â”€â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 40px 36px 36px;
      max-width: 480px;
      width: 100%;
      animation: fadeUp 0.4s var(--transition) both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€â”€ Start screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-start .coffee-icon {
      font-size: 64px;
      display: block;
      text-align: center;
      margin-bottom: 16px;
      filter: drop-shadow(0 2px 8px rgba(168,110,50,.3));
    }
    #screen-start h1 {
      font-size: 22px;
      font-weight: 900;
      text-align: center;
      line-height: 1.5;
      color: var(--brown-dark);
      margin-bottom: 12px;
    }
    #screen-start p {
      text-align: center;
      font-size: 14px;
      color: var(--brown-light);
      line-height: 1.8;
      margin-bottom: 32px;
    }

    /* â”€â”€â”€ Question screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-meta {
      margin-bottom: 16px;
      display: flex;
        justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--brown-light);
      font-weight: 700;
    }
      .progress-bar-wrap {
        height: 4px;
        background: var(--cream-dark);
        border-radius: 99px;
        margin-bottom: 8px;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--brown-mid), var(--gold));
        border-radius: 99px;
        transition: width var(--transition);
      }
    .q-text {
      font-size: 20px;
      font-weight: 700;
      line-height: 1.6;
      color: var(--brown-dark);
      margin-bottom: 28px;
    }

    /* â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .choice-btn {
      display: block;
      width: 100%;
      padding: 16px 20px;
      border: 2px solid var(--cream-dark);
      border-radius: 12px;
      background: var(--cream);
      color: var(--brown-dark);
      font-family: inherit;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      text-align: left;
      transition: border-color var(--transition), background var(--transition), transform var(--transition), box-shadow var(--transition);
    }
    .choice-btn:hover {
      border-color: var(--brown-mid);
      background: var(--white);
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }
    .choice-btn:active { transform: translateY(0); }

    .btn-primary {
      display: inline-block;
      padding: 16px 40px;
      background: linear-gradient(135deg, var(--brown-dark) 0%, var(--brown-mid) 100%);
      color: var(--white);
      border: none;
      border-radius: 99px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
      box-shadow: 0 4px 16px rgba(62,39,35,0.25);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(62,39,35,0.35);
    }
    .btn-primary:active { transform: translateY(0); }

    .btn-secondary {
      display: inline-block;
      padding: 12px 28px;
      background: transparent;
      color: var(--brown-mid);
      border: 2px solid var(--brown-light);
      border-radius: 99px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
    }
    .btn-secondary:hover {
      background: var(--cream-dark);
    }

    .btn-center { text-align: center; }

    /* â”€â”€â”€ Result screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-result .result-icon {
      font-size: 72px;
      display: block;
      text-align: center;
      margin-bottom: 16px;
    }
    #screen-result .result-label {
      text-align: center;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.15em;
      color: var(--gold);
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    #screen-result h2 {
      text-align: center;
      font-size: 24px;
      font-weight: 900;
      color: var(--brown-dark);
      line-height: 1.4;
      margin-bottom: 16px;
    }
    #screen-result .result-tagline {
      text-align: center;
      font-size: 14px;
      color: var(--brown-light);
      line-height: 1.8;
      margin-bottom: 28px;
    }
    .result-detail {
      background: var(--cream);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 28px;
    }
    .result-detail h3 {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: var(--brown-mid);
      margin-bottom: 12px;
      text-transform: uppercase;
    }
    .result-detail ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .result-detail li {
      font-size: 14px;
      color: var(--brown-dark);
      line-height: 1.6;
      padding-left: 20px;
      position: relative;
    }
    .result-detail li::before {
      content: 'â˜•';
      position: absolute;
      left: 0;
      font-size: 12px;
    }
    .result-actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .result-jump {
      margin-top: 20px;
      background: var(--cream);
      border-radius: 12px;
      padding: 16px;
    }
    .result-jump h3 {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: var(--brown-mid);
      margin-bottom: 12px;
      text-transform: uppercase;
    }
    .jump-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .jump-btn {
      padding: 8px 12px;
      border: 1px solid var(--brown-light);
      border-radius: 999px;
      background: var(--white);
      color: var(--brown-mid);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
    }
    .jump-btn:hover {
      background: var(--cream-dark);
    }

    /* â”€â”€â”€ Divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .divider {
      height: 1px;
      background: var(--cream-dark);
      margin: 28px 0;
    }

    /* â”€â”€â”€ Hidden â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hidden { display: none !important; }

    /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 500px) {
      .card { padding: 32px 24px 28px; }
      .q-text { font-size: 18px; }
      #screen-start h1 { font-size: 20px; }
    }
  </style>
</head>
<body>

  <header>
    <p class="logo">â˜• UTCC â€” University of Tokyo Coffee Club</p>
  </header>

  <!-- â•â•â•â•â•â• START SCREEN â•â•â•â•â•â• -->
  <div class="card" id="screen-start">
    <span class="coffee-icon">â˜•</span>
    <h1>UTCCã«å…¥ã£ãŸã‚‰<br>ã¾ãšä½•ã‚’ã—ã‚ˆã†ï¼Ÿ</h1>
    <p>
      ã„ãã¤ã‹ã®è³ªå•ã«ç­”ãˆã‚‹ã¨ã€<br>
      ã‚ãªãŸã«ã´ã£ãŸã‚Šã®æœ€åˆã®ä¸€æ­©ã‚’<br>
      ææ¡ˆã—ã¾ã™ï¼
    </p>
    <div class="btn-center">
      <button class="btn-primary" id="btn-start">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ â†’</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â• QUESTION SCREEN â•â•â•â•â•â• -->
  <div class="card hidden" id="screen-question">
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="progress-bar" style="width: 0%" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="è³ªå•é€²æ—"></div>
      </div>
    <div class="progress-meta">
      <span id="progress-count">0 / 24å•</span>
    </div>
    <p class="q-text" id="q-text"></p>
    <div class="choices" id="choices"></div>
  </div>

  <!-- â•â•â•â•â•â• RESULT SCREEN â•â•â•â•â•â• -->
  <div class="card hidden" id="screen-result">
    <span class="result-icon" id="result-icon"></span>
    <p class="result-label">è¨ºæ–­çµæœ</p>
    <h2 id="result-title"></h2>
    <p class="result-tagline" id="result-tagline"></p>
    <div class="divider"></div>
    <div class="result-detail">
      <h3>ã“ã‚“ãªæ´»å‹•ã§ã™</h3>
      <ul id="result-details"></ul>
    </div>
    <div class="result-actions">
      <button class="btn-primary" id="btn-retry">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
      <button class="btn-secondary" id="btn-other">ä»–ã®æ´»å‹•ã‚‚è¦‹ã¦ã¿ã‚‹</button>
    </div>
    <div class="result-jump">
      <h3>ä»–ã®çµæœã¸ã‚¸ãƒ£ãƒ³ãƒ—</h3>
      <div class="jump-list" id="result-jump-list"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• ALL RESULTS SCREEN â•â•â•â•â•â• -->
  <div class="card hidden" id="screen-all">
    <h2 style="font-size:18px;font-weight:900;margin-bottom:20px;">UTCCã®æ´»å‹•ä¸€è¦§</h2>
    <div id="all-results-list"></div>
    <div class="btn-center" style="margin-top:24px;">
      <button class="btn-secondary" id="btn-back-from-all">â† è¨ºæ–­ã«æˆ»ã‚‹</button>
    </div>
  </div>

  <script>
    // â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const MAX_QUESTIONS = 24;
    const MIN_QUESTIONS_FOR_RESULT = 10;
    const CONFIDENCE_TOP_PROB = 0.72;
    const CONFIDENCE_MARGIN = 0.18;
    const ANSWER_RELIABILITY = 0.82;

    const questions = [
      { id: 'q1', text: 'ç†è«–ã‚’ä½“ç³»çš„ã«å­¦ã¶æ–¹ãŒå¥½ãï¼Ÿ' },
      { id: 'q2', text: 'ã‚³ãƒ¼ãƒ’ãƒ¼ã¯é£²ã‚€ã‚ˆã‚Šæ·¹ã‚Œã‚‹å·¥ç¨‹ãã®ã‚‚ã®ãŒå¥½ãï¼Ÿ' },
      { id: 'q3', text: 'å®¶ã‚ˆã‚Šå¤–ã§æ´»å‹•ã™ã‚‹æ–¹ãŒå¥½ãï¼Ÿ' },
      { id: 'q4', text: 'ä¸€äººã®ç ”ç©¶ã‚ˆã‚Šä¼šè©±ä¸­å¿ƒã®å ´ãŒå¥½ãï¼Ÿ' },
      { id: 'q5', text: 'å‘³ã‚„é¦™ã‚Šã‚’è¨€èªåŒ–ã™ã‚‹ã®ãŒæ¥½ã—ã„ï¼Ÿ' },
      { id: 'q6', text: 'å™¨å…·ã®ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’è©°ã‚ã‚‹ã®ãŒå¥½ãï¼Ÿ' },
      { id: 'q7', text: 'çŸ­æ™‚é–“ã§ç›®ã«è¦‹ãˆã‚‹æˆæœãŒã»ã—ã„ï¼Ÿ' },
      { id: 'q8', text: 'æ™‚é–“ã‚’ã‹ã‘ã¦åœ°é“ã«æ”¹å–„ã™ã‚‹æ–¹ãŒå¥½ãï¼Ÿ' },
      { id: 'q9', text: 'ã‚³ãƒ¼ãƒ’ãƒ¼è±†ãŒç”Ÿè±†ã®çŠ¶æ…‹ã‹ã‚‰é–¢ã‚ã£ã¦ã¿ãŸã„ï¼Ÿ' },
      { id: 'q10', text: 'ãƒŸãƒ«ã‚¯ã‚’ä½¿ã†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æƒ¹ã‹ã‚Œã‚‹ï¼Ÿ' },
      { id: 'q11', text: 'å°‚é–€åº—ã®è¬›ç¾©ã‚’å—ã‘ã‚‹æ©Ÿä¼šã«é­…åŠ›ã‚’æ„Ÿã˜ã‚‹ï¼Ÿ' },
      { id: 'q12', text: 'ä¼ç”»é‹å–¶ã‚„åºƒå ±ã«ã‚‚èˆˆå‘³ãŒã‚ã‚‹ï¼Ÿ' },
      { id: 'q13', text: 'åŒã˜åº—ã‚ˆã‚Šæ–°è¦é–‹æ‹“ã®æ–¹ãŒãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ï¼Ÿ' },
      { id: 'q14', text: 'é€±æ¬¡ã§ã‚³ãƒ„ã‚³ãƒ„ç©ã¿ä¸Šã’ã‚‹ã®ãŒå¾—æ„ï¼Ÿ' },
      { id: 'q15', text: 'å¤§äººæ•°ã§å½¹å‰²åˆ†æ‹…ã™ã‚‹å ´ãŒå¥½ãï¼Ÿ' },
      { id: 'q16', text: 'å†ç¾æ€§ï¼ˆæ¯å›åŒã˜å‘³ï¼‰ã‚’å¼·ãé‡è¦–ã™ã‚‹ï¼Ÿ' },
      { id: 'q17', text: 'ç”£åœ°ãƒ»ç²¾è£½ãƒ»ç„™ç…åº¦ã®è©±é¡Œã«æƒ¹ã‹ã‚Œã‚‹ï¼Ÿ' },
      { id: 'q18', text: 'äººã«æä¾›ã—ã¦å–œã°ã‚Œã‚‹ä½“é¨“ãŒå¥½ãï¼Ÿ' },
      { id: 'q19', text: 'è¨˜éŒ²ã‚’å–ã‚ŠãªãŒã‚‰æ”¹å–„ã™ã‚‹ã®ãŒå¥½ãï¼Ÿ' },
      { id: 'q20', text: 'å½“æ—¥é‹å–¶ã‚ˆã‚Šäº‹å‰æº–å‚™ãŒå¾—æ„ï¼Ÿ' },
      { id: 'q21', text: 'è¦‹ãŸç›®ã®è¡¨ç¾ï¼ˆã‚¢ãƒ¼ãƒˆæ€§ï¼‰ã‚’é‡è¦–ã—ãŸã„ï¼Ÿ' },
      { id: 'q22', text: 'ç„™ç…é•ã„ã®æ¯”è¼ƒæ¤œè¨¼ã‚’ç´°ã‹ãã‚„ã‚ŠãŸã„ï¼Ÿ' },
      { id: 'q23', text: 'æœ€åˆã¯å¹…åºƒãè§¦ã£ã¦ã‹ã‚‰çµã‚ŠãŸã„ï¼Ÿ' },
      { id: 'q24', text: 'è£æ–¹ã®é”æˆæ„Ÿã«ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã‚‹ï¼Ÿ' }
    ];
    const questionMap = Object.fromEntries(questions.map(q => [q.id, q]));

    const results = {
      result_all_no: {
        icon: 'ğŸ—¿',
        title: 'ã™ã¹ã¦noã¨ã„ã†æ»ãã‚Œè€…',
        tagline: 'è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã‚ãªãŸã¯ã€Œã™ã¹ã¦Noã§çªãé€²ã‚€ã‚¿ã‚¤ãƒ—ã€ã§ã™ã€‚\nã“ã“ã¾ã§è²«ãã®ã¯ã€ã‚‚ã¯ã‚„ä¸€ã¤ã®ç¾å­¦ã€‚',
        details: [
          'è³ªå•ã«è¿åˆã›ãšã€è‡ªåˆ†ã®æ„Ÿè¦šã‚’å„ªå…ˆã™ã‚‹å§¿å‹¢ãŒå¼·ã„',
          'æµã•ã‚Œãªã„åˆ¤æ–­åŠ›ã¯ã€ä¼ç”»ã‚„é‹å–¶ã§æ­¦å™¨ã«ãªã‚‹',
          'ã¾ãšã¯ç„¡ç†ã«é¸ã°ãšã€é¢ç™½ãã†ãªå›ã‚’1ã¤ã ã‘è¦—ãã®ãŒæ­£è§£',
          'æ¬¡å›ã¯1ã¤ã ã‘Yesã‚’æ··ãœã‚‹ã¨ã€åˆ¥ã®é¡”ãŒè¦‹ãˆã¦ãã¾ã™'
        ]
      },
      result_teireikai: {
        icon: 'ğŸ“š',
        title: 'å®šä¾‹ä¼š',
        tagline: 'è‰²ã€…ã‚„ã‚‹ã€‚åˆå¿ƒè€…å‘ã‘ã‹ã‚‰ç„äººå‘ã‘ã¾ã§ã€‚\nã‚³ãƒ¼ãƒ’ãƒ¼ã«è©³ã—ããªã‚ŠãŸã„æ–¹ã«ãœã²ã€‚',
        details: [
          'åŸºç¤ã‹ã‚‰å¿œç”¨ã¾ã§å¹…åºƒã„ãƒ†ãƒ¼ãƒã‚’æ‰±ãˆã‚‹',
          'æŠ½å‡ºãƒ»è±†ãƒ»ç„™ç…ãªã©ã‚’æ¨ªæ–­ã—ã¦å­¦ã¹ã‚‹',
          'åˆå¿ƒè€…ã‹ã‚‰ä¸Šç´šè€…ã¾ã§åŒã˜å ´ã§æˆé•·ã§ãã‚‹',
          'è¿·ã£ãŸã‚‰ã¾ãšå‚åŠ ã—ã‚„ã™ã„ä¸­å¿ƒçš„ãªæ´»å‹•'
        ]
      },
      result_cafe: {
        icon: 'ğŸ—ºï¸',
        title: 'ã‚«ãƒ•ã‚§å·¡ã‚Š',
        tagline: 'ã‚«ãƒ•ã‚§ã‚’å·¡ã‚‹ã€‚\nå ´æ‰€ã¯éƒ½å†…ã‹ã‚‰éŒå€‰ç­‰ã¾ã§åŠã¶ã“ã¨ã‚‚ã€‚',
        details: [
          'æ–°ã—ã„åº—èˆ—ã®é–‹æ‹“ã‚’æ¥½ã—ã‚ã‚‹',
          'åº—ã”ã¨ã®é›°å›²æ°—ã‚„å‘³ã®é•ã„ã‚’ä½“æ„Ÿã§ãã‚‹',
          'è¡—æ­©ãã—ãªãŒã‚‰æ°—è»½ã«å‚åŠ ã—ã‚„ã™ã„',
          'å¤–ã§ã®æ´»å‹•ãŒå¥½ããªäººã«å‘ã„ã¦ã„ã‚‹'
        ]
      },
      result_roast: {
        icon: 'ğŸ”¥',
        title: 'ç„™ç…ä¼š',
        tagline: 'è±†ã‚’ç…ã‚‹ã€‚\nã‚„ã‚‹ãªã‚‰ã¯ã˜ã‚ã‹ã‚‰æœ€å¾Œã¾ã§ã€ã¨ã“ã¨ã‚“ã‚„ã‚Šã¬ããŸã„ã‚¿ã‚¤ãƒ—ã®ã‚ãªãŸã«ã€‚',
        details: [
          'ç”Ÿè±†ã‹ã‚‰ä»•ä¸Šã’ã¾ã§æ·±ãå–ã‚Šçµ„ã‚ã‚‹',
          'ç„™ç…åº¦ã¨é¢¨å‘³ã®é–¢ä¿‚ã‚’å®Ÿè·µã§å­¦ã¹ã‚‹',
          'è©¦è¡ŒéŒ¯èª¤ã‚’é‡ã­ã‚‹é¢ç™½ã•ãŒã‚ã‚‹',
          'ã¨ã“ã¨ã‚“æ¢ç©¶ã—ãŸã„äººå‘ã‘ã®æ´»å‹•'
        ]
      },
      result_espresso: {
        icon: 'ğŸ¨',
        title: 'ã‚¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚½ä¼š',
        tagline: 'ãƒ©ãƒ†ã‚¢ãƒ¼ãƒˆã€ãƒ†ã‚£ãƒ©ãƒŸã‚¹ç­‰ã€‚\nã‚«ãƒ•ã‚§ã§ã—ã‹é£²ã‚ãªã„ãƒ»é£Ÿã¹ã‚‰ã‚Œãªã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è‡ªåˆ†ã§å†ç¾ã§ãã‚‹ã€‚',
        details: [
          'ã‚¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚½æŠ½å‡ºã¨ãƒŸãƒ«ã‚¯æŠ€è¡“ã‚’å®Ÿè·µã§ãã‚‹',
          'ãƒ©ãƒ†ã‚¢ãƒ¼ãƒˆç·´ç¿’ã¯ç„¡é™å¤§ï¼ˆãƒãƒ¼ãƒˆã‹ã‚‰ã‚¹ãƒ¯ãƒ³ã¾ã§ï¼‰',
          'ã‚¢ãƒ¬ãƒ³ã‚¸ãƒ‰ãƒªãƒ³ã‚¯ã‚„ã‚¹ã‚¤ãƒ¼ãƒ„ã«ã‚‚æŒ‘æˆ¦ã§ãã‚‹',
          'å†ç¾æ€§ã¨è¡¨ç¾åŠ›ã®ä¸¡æ–¹ã‚’ç£¨ã‘ã‚‹'
        ]
      },
      result_seminar: {
        icon: 'ğŸ§ ',
        title: 'ã‚»ãƒŸãƒŠãƒ¼',
        tagline: 'ä¸å®šæœŸé–‹å‚¬ã€‚\næœ¬æ ¼æ´¾ã®åº—èˆ—ã§å®Ÿè·µçš„ãªçŸ¥è­˜ãŒå­¦ã¹ã¾ã™ã€‚',
        details: [
          'å°‚é–€åº—ãªã‚‰ã§ã¯ã®è¦–ç‚¹ã‚’å¸åã§ãã‚‹',
          'å®Ÿè·µã«ç›´çµã™ã‚‹çŸ¥è­˜ã‚’å­¦ã¹ã‚‹',
          'æ™®æ®µã®æ´»å‹•ã§ã¯å¾—ã«ãã„åˆºæ¿€ãŒã‚ã‚‹',
          'ç†è«–ã¨ç¾å ´æ„Ÿã®ä¸¡æ–¹ã‚’æ·±ã‚ã‚‰ã‚Œã‚‹'
        ]
      },
      result_operation: {
        icon: 'ğŸª',
        title: 'å„ç¨®é‹å–¶',
        tagline: 'ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»ã¾ã§æºã‚ã‚Œã‚‹ï¼\næä¾›ã ã‘ã§ãªãã€å ´ã¥ãã‚Šå…¨ä½“ã«é–¢ã‚ã‚Œã¾ã™ã€‚',
        details: [
          'ä¼ç”»ãƒ»æº–å‚™ãƒ»å½“æ—¥é‹å–¶ã¾ã§çµŒé¨“ã§ãã‚‹',
          'ãƒãƒ¼ãƒ é€£æºã§å¤§ããªå ´ã‚’ä½œã‚‹åŠ›ãŒã¤ã',
          'æ´»å‹•å…¨ä½“ã‚’æ”¯ãˆã‚‹å½¹å‰²ã«æŒ‘æˆ¦ã§ãã‚‹',
          'UTCCã®é­…åŠ›ã‚’å½¢ã«ã—ãŸã„äººã«å‘ã„ã¦ã„ã‚‹'
        ]
      }
    };

    const hiddenFromBrowse = new Set(['result_all_no']);

    const categoryProfiles = {
      result_teireikai: {
        q1: true, q2: true, q3: false, q4: false, q5: true, q6: true,
        q7: false, q8: true, q9: false, q10: false, q11: true, q12: false,
        q13: false, q14: true, q15: false, q16: true, q17: true, q18: false,
        q19: true, q20: false, q21: false, q22: true, q23: true, q24: false
      },
      result_cafe: {
        q1: false, q2: false, q3: true, q4: true, q5: false, q6: false,
        q7: true, q8: false, q9: false, q10: false, q11: false, q12: false,
        q13: true, q14: false, q15: true, q16: false, q17: false, q18: true,
        q19: false, q20: false, q21: true, q22: false, q23: true, q24: false
      },
      result_roast: {
        q1: true, q2: true, q3: false, q4: false, q5: false, q6: true,
        q7: false, q8: true, q9: true, q10: false, q11: false, q12: false,
        q13: false, q14: true, q15: false, q16: true, q17: true, q18: false,
        q19: true, q20: true, q21: false, q22: true, q23: false, q24: true
      },
      result_espresso: {
        q1: false, q2: true, q3: false, q4: false, q5: false, q6: true,
        q7: true, q8: true, q9: false, q10: true, q11: false, q12: false,
        q13: false, q14: true, q15: false, q16: true, q17: false, q18: true,
        q19: false, q20: false, q21: true, q22: false, q23: false, q24: false
      },
      result_seminar: {
        q1: true, q2: false, q3: false, q4: false, q5: true, q6: false,
        q7: false, q8: true, q9: false, q10: false, q11: true, q12: false,
        q13: false, q14: true, q15: false, q16: true, q17: true, q18: false,
        q19: true, q20: false, q21: false, q22: true, q23: true, q24: false
      },
      result_operation: {
        q1: false, q2: false, q3: true, q4: true, q5: false, q6: false,
        q7: true, q8: false, q9: false, q10: false, q11: false, q12: true,
        q13: true, q14: false, q15: true, q16: false, q17: false, q18: true,
        q19: false, q20: true, q21: false, q22: false, q23: true, q24: true
      }
    };

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentQuestionId = questions[0].id;
    let lastResult = null;
    const answers = {};

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const $ = id => document.getElementById(id);

    function show(screenId) {
      ['screen-start', 'screen-question', 'screen-result', 'screen-all'].forEach(id => {
        $(id).classList.toggle('hidden', id !== screenId);
      });
      // Re-trigger animation
      const el = $(screenId);
      el.style.animation = 'none';
      el.getBoundingClientRect(); // reflow
      el.style.animation = '';
    }

    function getCategoryScores() {
      const scores = Object.keys(categoryProfiles).reduce((acc, key) => {
        acc[key] = 0;
        return acc;
      }, {});

      Object.entries(answers).forEach(([qid, answer]) => {
        Object.entries(categoryProfiles).forEach(([category, profile]) => {
          const expectedYes = profile[qid];
          if (expectedYes === undefined) return;
          const expected = expectedYes ? 'yes' : 'no';
          scores[category] += answer === expected ? 2 : -1;
        });
      });

      return scores;
    }

    function getCategoryProbabilities(scores) {
      const entries = Object.entries(scores);
      const exps = entries.map(([, score]) => Math.exp(score));
      const sumExp = exps.reduce((sum, value) => sum + value, 0) || 1;
      const probabilities = {};
      entries.forEach(([key], i) => {
        probabilities[key] = exps[i] / sumExp;
      });
      return probabilities;
    }

    function calculateEntropy(probabilities) {
      return Object.values(probabilities).reduce((entropy, probability) => {
        if (probability <= 0) return entropy;
        return entropy - probability * Math.log2(probability);
      }, 0);
    }

    function normalizeDistribution(distribution) {
      const total = Object.values(distribution).reduce((sum, value) => sum + value, 0) || 1;
      const normalized = {};
      Object.entries(distribution).forEach(([key, value]) => {
        normalized[key] = value / total;
      });
      return normalized;
    }

    function posteriorByAnswer(probabilities, qid, answer) {
      const weighted = {};
      Object.entries(probabilities).forEach(([category, probability]) => {
        const expectedYes = categoryProfiles[category][qid];
        const expectedAnswer = expectedYes ? 'yes' : 'no';
        const likelihood = answer === expectedAnswer ? ANSWER_RELIABILITY : (1 - ANSWER_RELIABILITY);
        weighted[category] = probability * likelihood;
      });
      return normalizeDistribution(weighted);
    }

    function chooseNextQuestionId() {
      const unanswered = questions.filter(q => !(q.id in answers));
      if (unanswered.length === 0) return null;

      const scores = getCategoryScores();
      const probabilities = getCategoryProbabilities(scores);
      const currentEntropy = calculateEntropy(probabilities);

      let bestQuestion = unanswered[0].id;
      let bestScore = -Infinity;

      unanswered.forEach(question => {
        const qid = question.id;
        let pYes = 0;
        let pNo = 0;

        Object.entries(probabilities).forEach(([category, probability]) => {
          const expectedYes = categoryProfiles[category][qid];
          if (expectedYes) {
            pYes += probability * ANSWER_RELIABILITY;
            pNo += probability * (1 - ANSWER_RELIABILITY);
          } else {
            pYes += probability * (1 - ANSWER_RELIABILITY);
            pNo += probability * ANSWER_RELIABILITY;
          }
        });

        const yesPosterior = posteriorByAnswer(probabilities, qid, 'yes');
        const noPosterior = posteriorByAnswer(probabilities, qid, 'no');
        const expectedEntropy =
          pYes * calculateEntropy(yesPosterior) +
          pNo * calculateEntropy(noPosterior);
        const infoGain = currentEntropy - expectedEntropy;
        const halfSplitBonus = 1 - Math.abs(pYes - 0.5) * 2;
        const score = infoGain + 0.15 * halfSplitBonus;

        if (score > bestScore) {
          bestScore = score;
          bestQuestion = qid;
        }
      });

      return bestQuestion;
    }

    function shouldFinish(scores) {
      const answeredCount = Object.keys(answers).length;
      const allNoSoFar = Object.values(answers).length > 0 && Object.values(answers).every(v => v === 'no');

      if (answeredCount >= MAX_QUESTIONS) return true;
      if (allNoSoFar) return false;
      if (answeredCount < MIN_QUESTIONS_FOR_RESULT) return false;

      const probabilities = getCategoryProbabilities(scores);
      const sorted = Object.values(probabilities).sort((a, b) => b - a);
      const best = sorted[0] ?? 0;
      const second = sorted[1] ?? 0;
      return best >= CONFIDENCE_TOP_PROB && (best - second) >= CONFIDENCE_MARGIN;
    }

    function determineResult() {
      const scores = getCategoryScores();
      const tieOrder = [
        'result_operation',
        'result_roast',
        'result_espresso',
        'result_cafe',
        'result_seminar',
        'result_teireikai'
      ];

      let best = tieOrder[0];
      tieOrder.forEach(key => {
        if (scores[key] > scores[best]) best = key;
      });
      return best;
    }

    function renderQuestion(qId) {
      const q = questionMap[qId];
      if (!q) return;
      currentQuestionId = qId;
      const answeredCount = Object.keys(answers).length;
      const step = answeredCount + 1;
      const percent = Math.round((step / MAX_QUESTIONS) * 100);
      $('q-text').textContent = q.text;
      $('progress-bar').style.width = percent + '%';
      $('progress-bar').setAttribute('aria-valuenow', String(percent));
      $('progress-count').textContent = `${step} / ${MAX_QUESTIONS}å•`;
      const choicesEl = $('choices');
      choicesEl.innerHTML = '';

      [
        { id: 'yes', label: 'Yes' },
        { id: 'no', label: 'No' }
      ].forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = choice.label;
        btn.addEventListener('click', () => answerQuestion(choice.id));
        choicesEl.appendChild(btn);
      });
      show('screen-question');
    }

    function answerQuestion(choiceId) {
      answers[currentQuestionId] = choiceId;
      const answeredCount = Object.keys(answers).length;
      const isAllNo = Object.values(answers).every(v => v === 'no');

      if (answeredCount === MAX_QUESTIONS && isAllNo) {
        renderResult('result_all_no');
        return;
      }

      const scores = getCategoryScores();

      if (shouldFinish(scores)) {
        renderResult(determineResult());
        return;
      }

      const nextQuestionId = chooseNextQuestionId();
      if (!nextQuestionId) {
        renderResult(determineResult());
        return;
      }
      renderQuestion(nextQuestionId);
    }

    function renderResult(resultId) {
      const r = results[resultId];
      if (!r) return;
      lastResult = resultId;
      $('result-icon').textContent = r.icon;
      $('result-title').textContent = r.title;
      $('result-tagline').textContent = r.tagline;
      const ul = $('result-details');
      ul.innerHTML = '';
      r.details.forEach(d => {
        const li = document.createElement('li');
        li.textContent = d;
        ul.appendChild(li);
      });

      const jumpList = $('result-jump-list');
      jumpList.innerHTML = '';
      Object.entries(results).forEach(([id, data]) => {
        if (id === resultId) return;
        if (hiddenFromBrowse.has(id)) return;
        const button = document.createElement('button');
        button.className = 'jump-btn';
        button.textContent = `${data.icon} ${data.title}`;
        button.addEventListener('click', () => renderResult(id));
        jumpList.appendChild(button);
      });

      show('screen-result');
    }

    function renderAllResults() {
      const container = $('all-results-list');
      container.innerHTML = '';
      const browseEntries = Object.entries(results).filter(([id]) => !hiddenFromBrowse.has(id));
      browseEntries.forEach(([id, r], index) => {
        const div = document.createElement('button');
        div.type = 'button';
        div.style.cssText = 'margin-bottom:20px;width:100%;border:none;background:transparent;padding:0;text-align:left;cursor:pointer;';
        const isLast = index === browseEntries.length - 1;
        div.innerHTML = `
          <div style="display:flex;align-items:flex-start;gap:14px;padding:6px 4px;border-radius:10px;transition:background var(--transition);">
            <span style="font-size:32px;line-height:1;">${r.icon}</span>
            <div>
              <p style="font-size:15px;font-weight:700;color:var(--brown-dark);margin-bottom:6px;">${r.title}</p>
              <p style="font-size:13px;color:var(--brown-light);line-height:1.7;">${r.tagline.replace(/\n/g, '<br>')}</p>
            </div>
          </div>
          ${!isLast ? '<div class="divider" style="margin:20px 0 0;"></div>' : ''}
        `;
        div.addEventListener('mouseenter', () => {
          const content = div.firstElementChild;
          if (content) content.style.background = 'var(--cream-dark)';
        });
        div.addEventListener('mouseleave', () => {
          const content = div.firstElementChild;
          if (content) content.style.background = 'transparent';
        });
        div.addEventListener('click', () => renderResult(id));
        container.appendChild(div);
      });
      show('screen-all');
    }

    // â”€â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    $('btn-start').addEventListener('click', () => {
      Object.keys(answers).forEach(key => delete answers[key]);
      const firstQuestionId = chooseNextQuestionId() || questions[0].id;
      currentQuestionId = firstQuestionId;
      renderQuestion(firstQuestionId);
    });
    $('btn-retry').addEventListener('click', () => {
      Object.keys(answers).forEach(key => delete answers[key]);
      show('screen-start');
    });
    $('btn-other').addEventListener('click', () => renderAllResults());
    $('btn-back-from-all').addEventListener('click', () => {
      if (lastResult) renderResult(lastResult);
      else {
        const firstQuestionId = chooseNextQuestionId() || questions[0].id;
        currentQuestionId = firstQuestionId;
        renderQuestion(firstQuestionId);
      }
    });
  </script>
</body>
</html>
